<!doctype html>
<html>
  <head>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta charset="utf-8" />
    <title>Rate My Lambeth</title>
    <style>
      body,
      html {
        font-family: "Roboto";
        margin: 0;
        padding: 0;
        padding-bottom: env(safe-area-inset-bottom);
        height: 100%;
        overflow: hidden;
        max-height: 100dvh, 100vh;
      }

      body {
        display: flex;
        flex-direction: column;
        background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      }

      nav {
        display: flex;
        justify-content: space-between;
        padding: 20px;
        box-shadow: rgba(0, 0, 0, 0.45) 0px 25px 20px -20px;

        div {
          display: flex;
          gap: 10px;
          justify-content: end;
        }

        a {
          font-weight: bold;
          font-size: 16px;
          color: #333;
          text-decoration: none;
          border: none;
          background: none;
        }

        a:hover {
          text-decoration: underline;
        }
      }

      #street-view {
        flex-grow: 1;
        width: 100%;
      }

      .button-container {
        display: flex;
        height: 16vh;

        button {
          font-size: 28px;
          border: none;
          cursor: pointer;
          flex: 1;
          overflow: hidden;
        }
      }

      #vote_not {
        /* responsive font-size */
        font-size: 42px;
      }

      #vote_hot {
        font-size: 42px;
      }
    </style>
  </head>

  <body>
    <dialog>
      <h2>ðŸ”¥ Hot or ðŸ¤® Not?</h2>
      <p>Is this street hot or not?</p>

      <button>close</button>
    </dialog>
    <nav>
      <div>ðŸŒ³ rate my lambeth</div>
      <div>
        <a href="/static/about.html">about</a>
        <a href="/static/faq.html">faq</a>
      </div>
    </nav>

    <div id="street-view"></div>

    <div class="button-container">
      <button id="vote_not"><span>ðŸ¤® not</span></button>
      <button id="vote_hot"><span>ðŸ”¥ hot</span></button>
    </div>
  </body>

  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_lLDblzEhAKvNL7ppvUnfQxRkFUL08Bk"
    async
    defer
  ></script>
  <script>
    document.addEventListener(
      "keydown",
      (event) => {
        if (
          // Change or remove this condition depending on your requirements.
          (event.key === "ArrowUp" || // Move forward
            event.key === "ArrowDown" || // Move forward
            event.key === "ArrowLeft" || // Pan left
            event.key === "ArrowRight" || // Pan right
            event.key === "+" || // Zoom in
            event.key === "=" || // Zoom in
            event.key === "_" || // Zoom out
            event.key === "-") && // Zoom out
          !event.metaKey &&
          !event.altKey &&
          !event.ctrlKey
        ) {
          event.stopPropagation();
        }
      },
      { capture: true },
    );

    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen();
    }

    let panorama;
    let streetPoints = [];

    fetch("/static/data.json")
      .then((r) => r.json())
      .then((data) => {
        streetPoints = data;
        initialize();
      });

    function getRandomLocation() {
      const lat =
        Math.random() * (lambethBounds.north - lambethBounds.south) +
        lambethBounds.south;
      const lng =
        Math.random() * (lambethBounds.east - lambethBounds.west) +
        lambethBounds.west;
      return { lat, lng };
    }

    function getRandomLocation2() {
      const loc = streetPoints[Math.floor(Math.random() * streetPoints.length)];
      return loc;
    }

    function initialize() {
      const fenway = getRandomLocation2();
      console.log(fenway);
      panorama = new google.maps.StreetViewPanorama(
        document.getElementById("street-view"),
        {
          position: fenway,
          pov: { heading: 165, pitch: 0 },
          zoom: 1,
          addressControl: false,
          linksControl: false,
          motionTracking: false,
          motionTrackingControl: false,
          fullscreenControl: false,
          enableCloseButton: false,
          clickToGo: false,
          zoomControl: false,
          keyboardControl: false,
        },
      );

      panorama.addListener("status_changed", function () {
        if (panorama.getStatus() !== google.maps.StreetViewStatus.OK) {
          setRandomLocation();
        }
      });
    }

    function setRandomLocation() {
      const loc = getRandomLocation2();
      panorama.setPosition(loc);
      console.log(loc);
    }

    function submitHot() {
      setRandomLocation();
    }

    function submitNot() {
      setRandomLocation();
    }

    button = document.getElementById("vote_hot");
    button.addEventListener("click", submitHot);

    submit = document.getElementById("vote_not");
    submit.addEventListener("click", submitNot);

    const dialog = document.querySelector("dialog");
    const faq = document.querySelector("nav button");
    const closeButton = document.querySelector("dialog button");

    faq.addEventListener("click", () => {
      dialog.showModal();
    });

    closeButton.addEventListener("click", () => {
      dialog.close();
    });
  </script>
</html>
